<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Wheel of Clinical Instructors</title>
<style>
  :root{
    --primary:#1e88e5;
    --primary-dark:#1565c0;
    --accent:#26a69a;
    --danger:#d32f2f;
    --bg:#f3f5f8;
    --card:#ffffff;
    --text:#243243;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:var(--bg); color:var(--text);
  }
  header{
    background:var(--primary); color:#fff; padding:14px 16px; text-align:center;
    font-weight:600; letter-spacing:.2px;
  }
  .container{max-width:1100px; margin:20px auto; padding:0 14px;}
  .grid{display:grid; grid-template-columns:1fr; gap:16px;}
  @media(min-width:920px){ .grid{grid-template-columns:420px 1fr;} }

  .card{
    background:var(--card); border-radius:14px; box-shadow:0 6px 18px rgba(0,0,0,.06);
    padding:16px;
  }

  /* Wheel */
  .wheel-wrap{display:flex; flex-direction:column; align-items:center}
  canvas{display:block; margin:auto; background:#fff; border-radius:50%;
    box-shadow:0 6px 18px rgba(0,0,0,.08);}
  .pointer{margin-top:10px; color:#555; font-size:14px}
  .controls{margin-top:12px; display:flex; flex-wrap:wrap; gap:8px; justify-content:center}
  .btn{
    border:none; background:var(--primary); color:#fff; padding:10px 14px; border-radius:10px;
    cursor:pointer; font-weight:600; transition:.2s transform, .25s background;
  }
  .btn:hover{background:var(--primary-dark)}
  .btn:active{transform:scale(.98)}
  .btn-outline{background:#fff; color:var(--primary); border:2px solid var(--primary)}
  .btn-danger{background:var(--danger)}
  .btn-muted{background:#90a4ae}
  .btn-muted:hover{background:#7b8e99}

  /* Instructor Button Grid */
  .instructor-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    gap: 10px;
    margin-top: 12px;
  }
  .instructor-btn {
    background: var(--accent);
    border: none;
    padding: 10px;
    border-radius: 10px;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
    transition: background .2s, transform .15s;
  }
  .instructor-btn:hover { background: #1d8a7a; transform: translateY(-2px); }
  .instructor-btn:disabled { background: #cfd8dc; color: #455a64; cursor: not-allowed; }

  /* Tags */
  .tagbox{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
  .tag{
    display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
    background:#e3f2fd; color:#0d47a1; font-weight:600; font-size:14px;
    box-shadow:0 2px 6px rgba(0,0,0,.06);
  }
  .tag button{
    border:none; background:transparent; color:#0d47a1; font-weight:700; cursor:pointer;
  }

  /* Form */
  form .row{display:grid; grid-template-columns:1fr; gap:10px; margin-top:10px}
  @media(min-width:680px){ form .row{grid-template-columns:1.5fr 1fr 1.5fr} }
  label{font-size:12px; font-weight:700; color:#637381; display:block; margin-bottom:6px}
  input[type="text"], select{
    width:100%; padding:10px 12px; border:1px solid #dfe3e8; border-radius:10px; outline:none;
  }
  input[readonly]{background:#f7f9fc}
  .form-actions{margin-top:10px; display:flex; flex-wrap:wrap; gap:8px}

  /* Table */
  table{width:100%; border-collapse:collapse; margin-top:10px; background:#fff;
    border-radius:12px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,.05)}
  thead th{
    background:var(--primary); color:#fff; padding:10px; font-weight:700; text-align:center;
  }
  tbody td{padding:10px; border-bottom:1px solid #eef2f5; text-align:center}
  tbody tr:nth-child(even){background:#fafbfd}
  td[contenteditable="true"]{background:#fffdf4}
  .actions .btn{padding:6px 10px; border-radius:8px; font-size:13px}

  .toolbar{display:flex; flex-wrap:wrap; gap:8px; margin-top:12px}
  .note{font-size:12px; color:#6b7c8a}

  /* Group Header */
  .group-header td { cursor:pointer; }
  .group-header .arrow { font-weight:bold; margin-right:6px; }
</style>
</head>
<body>
<header>Wheel of Clinical Instructors</header>

<div class="container">
  <div class="grid">
    <!-- Left: Wheel + Instructor buttons -->
    <section class="card">
      <h3 style="margin:0 0 8px">Clinical Instructor Wheel</h3>
      <div class="wheel-wrap">
        <canvas id="wheel" width="360" height="360" aria-label="Wheel of Names"></canvas>
        <div class="pointer">▲ The arrow points to the selected instructor</div>
        <div class="controls">
          <button class="btn" id="spinBtn">Spin (5s)</button>
          <button class="btn btn-outline" id="removePickedBtn" disabled>Remove Picked Instructor</button>
        </div>
      </div>

      <h4 style="margin:14px 0 6px">Select Clinical Instructors</h4>
      <div id="instructorGrid" class="instructor-grid"></div>
      <div id="tagBox" class="tagbox"></div>
      <div class="note">Tip: Click ❌ on a tag to remove that instructor from the wheel.</div>
    </section>

    <!-- Right: Form -->
    <section class="card">
      <h3 style="margin:0 0 8px">Record Details</h3>
      <form id="entryForm" onsubmit="return false;">
        <div class="row">
          <div>
            <label>Your Clinical Instructor</label>
            <input id="pickedInstructor" type="text" readonly placeholder="Spin the wheel to pick" />
          </div>
          <div>
            <label>Clinical Level</label>
            <select id="clinicalLevel">
              <option value="42">42</option>
              <option value="41">41</option>
              <option value="32">32</option>
              <option value="31">31</option>
            </select>
          </div>
          <div>
            <label>Clinician Name</label>
            <input id="clinicianName" type="text" placeholder="Enter clinician name" />
          </div>
        </div>
        <div class="row">
          <div>
            <label>Patient Name</label>
            <input id="patientName" type="text" placeholder="Enter patient name" />
          </div>
          <div>
            <label>Mastercard No.</label>
            <input id="mastercardNo" type="text" placeholder="Enter Mastercard number" />
          </div>
        </div>
        <div class="row" style="grid-template-columns:1fr;">
          <div>
            <label>Clinical Procedure</label>
            <input id="clinicalProcedure" type="text" placeholder="Enter clinical procedure" />
          </div>
        </div>
        <div class="form-actions">
          <button class="btn" id="addResultBtn">Add to Results</button>
          <button class="btn btn-muted" id="clearFormBtn" type="button">Clear Form</button>
        </div>
      </form>

      <div class="toolbar">
        <button class="btn" id="printBtn" type="button">Print Table</button>
        <button class="btn" id="csvBtn" type="button">Save CSV</button>
        <button class="btn btn-danger" id="resetBtn" type="button">Reset Results</button>
      </div>
      <div class="note">“Completed” column is intentionally blank so you can fill it later.</div>
    </section>
  </div>

  <!-- Results Table -->
  <section class="card" style="margin-top:16px;">
    <h3 style="margin:0 0 8px">Results</h3>
    <table id="resultsTable" aria-label="Results table">
      <thead>
        <tr>
          <th>Your Clinical Instructor</th>
          <th>Clinician Name</th>
          <th>Patient Name</th>
          <th>Mastercard No.</th>
          <th>Clinical Level</th>
          <th>Time/Date Taken</th>
          <th>Clinical Procedure</th>
          <th>Completed</th>
          <th class="actions">Actions</th>
        </tr>
      </thead>
      <tbody id="resultsBody"></tbody>
    </table>
  </section>
  </div>
    <script>
const LS_KEYS = { NAMES:'ci_wheel_names_v2', RESULTS:'ci_results_v2' };
let names=[], colors=[], pickedName='', startAngle=0, arc=0, spinning=false, ctx;
const SPIN_DURATION=5000;
const ALL_INSTRUCTORS=[
  "Dr. Macadangdang","Dr. Abdurahman","Dr. Malinao","Dr. Revil","Dr. Barniego","Dr. Banzon",
  "Dr. Bueno","Dr. Saldon J.","Dr. Recede","Dr. Mangahas-Saldon","Dr. Quimpan","Dr. Diano",
  "Dr. Sumaoy","Dr. Petalino","Dr. Bocala","Dr. Ampuan","Dr. Kimble","Dr. Dela Cruz"
];

const wheel=document.getElementById('wheel');
const tagBox=document.getElementById('tagBox');
const instructorGrid=document.getElementById("instructorGrid");
const pickedInstructorInput=document.getElementById('pickedInstructor');
const levelSelect=document.getElementById('clinicalLevel');
const clinicianNameInput=document.getElementById('clinicianName');
const procedureInput=document.getElementById('clinicalProcedure');
const patientNameInput=document.getElementById('patientName');
const mastercardNoInput=document.getElementById('mastercardNo');
const addResultBtn=document.getElementById('addResultBtn');
const clearFormBtn=document.getElementById('clearFormBtn');
const printBtn=document.getElementById('printBtn');
const csvBtn=document.getElementById('csvBtn');
const resetBtn=document.getElementById('resetBtn');
const spinBtn=document.getElementById('spinBtn');
const removePickedBtn=document.getElementById('removePickedBtn');
const resultsBody=document.getElementById('resultsBody');

/* ---------- Utilities ---------- */
function saveNames(){localStorage.setItem(LS_KEYS.NAMES,JSON.stringify(names));}
function loadNames(){try{return JSON.parse(localStorage.getItem(LS_KEYS.NAMES)||'[]')}catch{return []}}
function saveResults(){
  const rows=[]; resultsBody.querySelectorAll("tr[data-row='true']").forEach(tr=>{
    const cells=tr.querySelectorAll('td');
    rows.push({instructor:cells[0].innerText.trim(),clinician:cells[1].innerText.trim(),
      patient:cells[2].innerText.trim(),mastercard:cells[3].innerText.trim(),
      level:cells[4].innerText.trim(),datetime:cells[5].innerText.trim(),
      procedure:cells[6].innerText.trim(),completed:cells[7].innerText.trim()});
  });
  localStorage.setItem(LS_KEYS.RESULTS,JSON.stringify(rows));
}
function loadResults(){try{return JSON.parse(localStorage.getItem(LS_KEYS.RESULTS)||'[]')}catch{return []}}
function randColor(){return `hsl(${Math.floor(Math.random()*360)} 75% 50%)`;}
function formatNow(){return new Date().toLocaleString();}

/* ---------- Wheel Instructors ---------- */
function renderTags(){
  tagBox.innerHTML='';
  names.forEach(n=>{
    const tag=document.createElement('span');
    tag.className='tag'; tag.innerHTML=`<span>${n}</span><button>❌</button>`;
    tag.querySelector('button').onclick=()=>{
      removeInstructor(n);
      const btn=[...document.querySelectorAll(".instructor-btn")].find(b=>b.textContent===n);
      if(btn) btn.disabled=false;
    };
    tagBox.appendChild(tag);
  });
}
function addInstructor(name){if(!name||names.includes(name))return;names.push(name);colors.push(randColor());saveNames();renderTags();drawWheel();}
function removeInstructor(name){const i=names.indexOf(name);if(i>-1){names.splice(i,1);colors.splice(i,1);if(pickedName===name){pickedName='';pickedInstructorInput.value='';removePickedBtn.disabled=true;}saveNames();renderTags();drawWheel();}}

/* ---------- Wheel Drawing ---------- */
function drawWheel(){
  const w=wheel.width,h=wheel.height,cx=w/2,cy=h/2,radius=Math.min(cx,cy)-4;
  if(!ctx)ctx=wheel.getContext('2d'); ctx.clearRect(0,0,w,h);
  if(names.length===0){ctx.fillStyle='#90a4ae';ctx.font='14px Arial';ctx.textAlign='center';ctx.fillText('Add Clinical Instructors and spin!',cx,cy);return;}
  arc=Math.PI/(names.length/2);
  for(let i=0;i<names.length;i++){const angle=startAngle+i*arc;ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,radius,angle,angle+arc,false);ctx.closePath();ctx.fillStyle=colors[i];ctx.fill();}
  ctx.save();ctx.fillStyle='#fff';ctx.font='bold 14px Arial';
  for(let i=0;i<names.length;i++){const angle=startAngle+i*arc,mid=angle+arc/2,tx=cx+Math.cos(mid)*radius*0.65,ty=cy+Math.sin(mid)*radius*0.65;
    ctx.save();ctx.translate(tx,ty);ctx.rotate(mid);let text=names[i],fontSize=14;ctx.font=`bold ${fontSize}px Arial`;
    while(ctx.measureText(text).width>radius*0.9&&fontSize>10){fontSize--;ctx.font=`bold ${fontSize}px Arial`;}
    ctx.fillText(text,-ctx.measureText(text).width/2,0);ctx.restore();}
  ctx.restore();ctx.fillStyle='#e53935';ctx.beginPath();ctx.moveTo(cx-8,cy-radius-4);ctx.lineTo(cx+8,cy-radius-4);ctx.lineTo(cx,cy-radius-28);ctx.closePath();ctx.fill();
}
function easeOutCubic(t){return 1-Math.pow(1-t,3);}
function spin(){if(spinning||names.length===0){if(names.length===0)alert('Add Clinical Instructors first');return;}
  spinning=true;spinBtn.disabled=true;const start=performance.now(),initialAngle=startAngle,extra=6+Math.random()*2;
  function frame(now){const t=Math.min((now-start)/SPIN_DURATION,1),e=easeOutCubic(t);startAngle=initialAngle+e*(extra*2*Math.PI);drawWheel();if(t<1)requestAnimationFrame(frame);else{spinning=false;spinBtn.disabled=false;finalizePick();}}
  requestAnimationFrame(frame);}
function finalizePick(){const deg=(startAngle*180/Math.PI+90)%360,arcd=arc*180/Math.PI;let i=Math.floor((360-deg)/arcd)%names.length;if(i<0)i+=names.length;pickedName=names[i];pickedInstructorInput.value=pickedName;removePickedBtn.disabled=false;}
function removePickedFromWheel(){if(!pickedName)return;removeInstructor(pickedName);pickedName='';pickedInstructorInput.value='';removePickedBtn.disabled=true;}

/* ---------- Results Table ---------- */
function addResult(){
  const instructor=pickedInstructorInput.value.trim(),clinician=clinicianNameInput.value.trim(),
        patient=patientNameInput.value.trim(),mastercard=mastercardNoInput.value.trim(),
        level=levelSelect.value,procedure=procedureInput.value.trim();
  if(!instructor||!clinician||!patient||!mastercard||!procedure){alert('Fill all fields');return;}
  const now=formatNow(),row={instructor,clinician,patient,mastercard,level,datetime:now,procedure,completed:""};
  const rows=loadResults();rows.push(row);localStorage.setItem(LS_KEYS.RESULTS,JSON.stringify(rows));rebuildResultsFromStorage();
}
function printTable(){const html=document.getElementById('resultsTable').outerHTML,w=window.open('','','width=1200,height=800');
  w.document.write(`<html><head><title>Print Results</title><style>@page{size:landscape;margin:20px;}table{width:100%;border-collapse:collapse}th,td{border:1px solid #aaa;padding:8px;text-align:center}thead th{background:#eee}.actions{display:none}</style></head><body>${html}</body></html>`);w.document.close();w.print();}
function saveCSV(){let csv='Instructor,Clinician,Patient,Mastercard,Level,Time/Date,Procedure,Completed\n';
  resultsBody.querySelectorAll('tr[data-row="true"]').forEach(tr=>{const tds=tr.querySelectorAll('td');csv+=Array.from(tds).slice(0,8).map(td=>`"${td.innerText.replace(/"/g,'""')}"`).join(',')+'\n';});
  const blob=new Blob([csv],{type:'text/csv'}),url=URL.createObjectURL(blob),a=document.createElement('a');a.href=url;a.download='results.csv';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);}

function rebuildResultsFromStorage(){
  const rows=loadResults();resultsBody.innerHTML='';
  const grouped={};rows.forEach(r=>{const ins=r.instructor||"Unknown";if(!grouped[ins])grouped[ins]=[];grouped[ins].push(r);});
  Object.keys(grouped).forEach(ins=>{
    const headerRow=document.createElement('tr');
    headerRow.classList.add("group-header");
    headerRow.innerHTML=`<td colspan="9" style="background:#e3f2fd;font-weight:bold;text-align:left;"><span class="arrow">▼</span> Clinical Instructor: ${ins}</td>`;
    resultsBody.appendChild(headerRow);
    grouped[ins].forEach(r=>{
      const tr=document.createElement('tr');tr.setAttribute("data-row","true");tr.setAttribute("data-group",ins);
      tr.innerHTML=`<td contenteditable="true">${r.instructor||''}</td>
        <td contenteditable="true">${r.clinician||''}</td>
        <td contenteditable="true">${r.patient||''}</td>
        <td contenteditable="true">${r.mastercard||''}</td>
        <td contenteditable="true">${r.level||''}</td>
        <td contenteditable="true">${r.datetime||''}</td>
        <td contenteditable="true">${r.procedure||''}</td>
        <td contenteditable="true">${r.completed||''}</td>
        <td class="actions"><button class="btn btn-danger" type="button">Delete</button></td>`;
      tr.querySelector('.actions .btn').onclick=()=>{tr.remove();saveResults();rebuildResultsFromStorage();};
      tr.querySelectorAll('td[contenteditable="true"]').forEach(td=>{td.addEventListener('input',()=>{saveResults();});td.addEventListener('blur',()=>{saveResults();});});
      resultsBody.appendChild(tr);
    });
    headerRow.addEventListener("click",()=>{
      const rows=document.querySelectorAll(`tr[data-group="${ins}"]`);
      const arrow=headerRow.querySelector(".arrow");
      const hidden=[...rows].every(r=>r.style.display==="none");
      if(hidden){rows.forEach(r=>r.style.display="");arrow.textContent="▼";}
      else{rows.forEach(r=>r.style.display="none");arrow.textContent="▶";}
    });
  });
}

/* ---------- Init ---------- */
function init(){
  names=loadNames();colors=names.map(()=>randColor());renderTags();drawWheel();rebuildResultsFromStorage();
  ALL_INSTRUCTORS.forEach(name=>{const btn=document.createElement("button");btn.className="instructor-btn";btn.textContent=name;
    btn.onclick=()=>{addInstructor(name);btn.disabled=true;};if(names.includes(name))btn.disabled=true;instructorGrid.appendChild(btn);});
  spinBtn.onclick=spin;removePickedBtn.onclick=removePickedFromWheel;addResultBtn.onclick=addResult;
  clearFormBtn.onclick=()=>{clinicianNameInput.value='';procedureInput.value='';patientNameInput.value='';mastercardNoInput.value='';};
  printBtn.onclick=printTable;csvBtn.onclick=saveCSV;
  resetBtn.onclick=()=>{if(confirm('Clear all rows?')){resultsBody.innerHTML='';localStorage.removeItem(LS_KEYS.RESULTS);}};
}
init();
</script>
</body>
</html>      
