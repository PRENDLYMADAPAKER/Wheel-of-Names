<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wheel of Clinical Instructors</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    color: #333;
    margin-bottom: 10px;
  }
  .container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    max-width: 1200px;
    width: 100%;
  }
  canvas {
    background: white;
    border-radius: 50%;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  .controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 300px;
    width: 100%;
  }
  textarea {
    width: 100%;
    height: 150px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    resize: none;
  }
  button {
    padding: 10px;
    border: none;
    border-radius: 8px;
    background: #4CAF50;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: transform 0.1s ease, background 0.3s;
  }
  button:hover {
    background: #45a049;
  }
  button:active {
    transform: scale(0.95);
  }
  table {
    border-collapse: collapse;
    width: 100%;
    max-width: 900px;
    margin-top: 20px;
    background: white;
    border-radius: 8px;
    overflow: hidden;
  }
  th, td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #ddd;
  }
  tr:nth-child(even) { background-color: #f9f9f9; }
  th {
    background-color: #4CAF50;
    color: white;
  }
  .btn-small {
    padding: 5px 8px;
    font-size: 14px;
    border-radius: 6px;
    margin: 2px;
  }
  .edit-mode {
    background-color: #fff3cd !important;
  }
</style>
</head>
<body>

<h1>Wheel of Clinical Instructors</h1>
<div class="container">
  <canvas id="wheel" width="300" height="300"></canvas>
  <div class="controls">
    <textarea id="names" placeholder="Enter Clinical Instructors, one per line"></textarea>
    <button onclick="drawWheel()">Update Wheel</button>
    <button onclick="spinWheel()">Spin Wheel</button>
    <button onclick="removePicked()">Remove Picked Instructor</button>
    <button onclick="saveCSV()">Save CSV</button>
    <button onclick="printTable()">Print Table</button>
    <button onclick="resetTable()">Reset Table</button>
  </div>
</div>

<h2 id="winner">Your Clinical Instructor: </h2>

<table id="resultsTable">
  <thead>
    <tr>
      <th>Clinical Instructor</th>
      <th>Clinical Level</th>
      <th>Time/Date Taken</th>
      <th>Clinical Procedure</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let names = [];
let startAngle = 0;
let arc = 0;
let spinTimeout = null;
let spinAngleStart = 0;
let spinTime = 0;
let spinTimeTotal = 0;
let ctx;
let pickedName = '';

function drawWheel() {
  names = document.getElementById("names").value.split("\n").filter(n => n.trim() !== "");
  arc = Math.PI / (names.length / 2);
  const canvas = document.getElementById("wheel");
  if (canvas.getContext) {
    ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, 300, 300);
    for (let i = 0; i < names.length; i++) {
      const angle = startAngle + i * arc;
      ctx.fillStyle = i % 2 === 0 ? "#f8b400" : "#f85f73";
      ctx.beginPath();
      ctx.moveTo(150, 150);
      ctx.arc(150, 150, 150, angle, angle + arc, false);
      ctx.lineTo(150, 150);
      ctx.fill();
      ctx.save();
      ctx.translate(150 + Math.cos(angle + arc / 2) * 100, 
                    150 + Math.sin(angle + arc / 2) * 100);
      ctx.rotate(angle + arc / 2);
      ctx.fillStyle = "white";
      ctx.font = "bold 14px Arial";
      ctx.fillText(names[i], -ctx.measureText(names[i]).width / 2, 0);
      ctx.restore();
    }
  }
}

function spinWheel() {
  if (names.length === 0) { alert("Please enter names first!"); return; }
  spinAngleStart = Math.random() * 10 + 10;
  spinTime = 0;
  spinTimeTotal = Math.random() * 3000 + 4000;
  rotateWheel();
}

function rotateWheel() {
  spinTime += 30;
  if (spinTime >= spinTimeTotal) {
    stopRotateWheel();
    return;
  }
  const spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
  startAngle += (spinAngle * Math.PI / 180);
  drawWheel();
  spinTimeout = setTimeout(rotateWheel, 30);
}

function stopRotateWheel() {
  clearTimeout(spinTimeout);
  const degrees = startAngle * 180 / Math.PI + 90;
  const arcd = arc * 180 / Math.PI;
  const index = Math.floor((360 - (degrees % 360)) / arcd) % names.length;
  pickedName = names[index];
  document.getElementById("winner").textContent = "Your Clinical Instructor: " + pickedName;
  addResult(pickedName);
}

function easeOut(t, b, c, d) {
  const ts = (t /= d) * t;
  const tc = ts * t;
  return b + c * (tc + -3 * ts + 3 * t);
}

function addResult(name) {
  const tbody = document.querySelector("#resultsTable tbody");
  const tr = document.createElement("tr");
  const date = new Date().toLocaleString();
  
  tr.innerHTML = `
    <td>${name}</td>
    <td>
      <select>
        <option value="42">42</option>
        <option value="41">41</option>
        <option value="32">32</option>
        <option value="31">31</option>
      </select>
    </td>
    <td>${date}</td>
    <td contenteditable="true"></td>
    <td>
      <button class="btn-small" onclick="editRow(this)">Edit</button>
      <button class="btn-small" onclick="deleteRow(this)">Delete</button>
    </td>
  `;
  tbody.appendChild(tr);
}

function editRow(btn) {
  const row = btn.closest("tr");
  if (btn.textContent === "Edit") {
    row.classList.add("edit-mode");
    row.querySelectorAll("td[contenteditable], select").forEach(cell => cell.removeAttribute("disabled"));
    btn.textContent = "Save";
  } else {
    row.classList.remove("edit-mode");
    btn.textContent = "Edit";
  }
}

function deleteRow(btn) {
  btn.closest("tr").remove();
}

function removePicked() {
  if (pickedName) {
    names = names.filter(n => n !== pickedName);
    document.getElementById("names").value = names.join("\n");
    drawWheel();
    pickedName = '';
  }
}

function saveCSV() {
  let csv = "Clinical Instructor,Clinical Level,Time/Date Taken,Clinical Procedure\n";
  document.querySelectorAll("#resultsTable tbody tr").forEach(row => {
    const cols = row.querySelectorAll("td");
    csv += Array.from(cols).slice(0,4).map(c => c.innerText || c.querySelector("select").value).join(",") + "\n";
  });
  const blob = new Blob([csv], { type: "text/csv" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "results.csv";
  link.click();
}

function printTable() {
  const printWindow = window.open("", "", "width=800,height=600");
  printWindow.document.write("<html><head><title>Print</title></head><body>");
  printWindow.document.write(document.querySelector("#resultsTable").outerHTML);
  printWindow.document.write("</body></html>");
  printWindow.document.close();
  printWindow.print();
}

function resetTable() {
  document.querySelector("#resultsTable tbody").innerHTML = "";
}

drawWheel();
</script>
</body>
</html>
