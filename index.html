<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clinical Instructor Picker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 0;
    text-align: center;
    color: #333;
  }
  h1 {
    background: #007bff;
    color: white;
    padding: 10px;
    margin: 0;
  }
  canvas { margin-top: 20px; }
  .input-section {
    margin-top: 15px;
  }
  input, select, button {
    padding: 8px;
    margin: 5px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
  .tags {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin: 10px 0;
  }
  .tag {
    background: #17a2b8;
    color: white;
    padding: 5px 10px;
    border-radius: 20px;
    margin: 3px;
    cursor: pointer;
  }
  table {
    margin: 20px auto;
    border-collapse: collapse;
    width: 95%;
    background: white;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
  }
  th {
    background: #007bff;
    color: white;
  }
  td[contenteditable="true"] {
    background: #f9f9f9;
    cursor: text;
  }
  .btns {
    margin: 15px;
  }
  .btns button {
    padding: 8px 12px;
    margin: 3px;
    border: none;
    border-radius: 4px;
    background: #007bff;
    color: white;
    cursor: pointer;
  }
  .btns button:hover {
    background: #0056b3;
  }
</style>
</head>
<body>

<h1>Wheel of Clinical Instructors</h1>

<canvas id="wheelCanvas" width="300" height="300"></canvas>
<div class="input-section">
  <input type="text" id="nameInput" placeholder="Type Clinical Instructor & press Enter">
  <div class="tags" id="nameTags"></div>
</div>

<form id="detailsForm">
  <div>
    <label>Clinician Name:</label>
    <input type="text" id="clinicianName">
  </div>
  <div>
    <label>Clinical Level:</label>
    <select id="clinicalLevel">
      <option value="42">42</option>
      <option value="41">41</option>
      <option value="32">32</option>
      <option value="31">31</option>
    </select>
  </div>
  <div>
    <label>Clinical Procedure:</label>
    <input type="text" id="clinicalProcedure">
  </div>
</form>

<div class="btns">
  <button type="button" onclick="spinWheel()">Spin Wheel</button>
  <button type="button" onclick="printTable()">Print</button>
  <button type="button" onclick="saveCSV()">Save CSV</button>
  <button type="button" onclick="resetResults()">Reset Results</button>
</div>

<table id="resultsTable">
  <thead>
    <tr>
      <th>Your Clinical Instructor</th>
      <th>Clinician Name</th>
      <th>Clinical Level</th>
      <th>Clinical Procedure</th>
      <th>Completed</th>
      <th>Remove</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let names = [];
let colors = [];
let startAngle = 0;
let arc = Math.PI / 6;
let spinTimeout = null;
let spinAngleStart = 0;
let spinTime = 0;
let spinTimeTotal = 0;
let ctx;

function drawWheel() {
  let canvas = document.getElementById("wheelCanvas");
  if (canvas.getContext) {
    let outsideRadius = 140;
    let textRadius = 110;
    let insideRadius = 20;
    ctx = canvas.getContext("2d");
    ctx.clearRect(0,0,300,300);

    ctx.strokeStyle = "black";
    ctx.lineWidth = 2;
    ctx.font = '14px Arial';

    arc = Math.PI / (names.length / 2);
    for (let i = 0; i < names.length; i++) {
      let angle = startAngle + i * arc;
      ctx.fillStyle = colors[i];
      ctx.beginPath();
      ctx.arc(150, 150, outsideRadius, angle, angle + arc, false);
      ctx.arc(150, 150, insideRadius, angle + arc, angle, true);
      ctx.fill();
      ctx.save();
      ctx.fillStyle = "white";
      ctx.translate(150 + Math.cos(angle + arc / 2) * textRadius,
                    150 + Math.sin(angle + arc / 2) * textRadius);
      ctx.rotate(angle + arc / 2);
      let text = names[i];
      ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
      ctx.restore();
    }
    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.moveTo(150 - 4, 150 - (outsideRadius + 5));
    ctx.lineTo(150 + 4, 150 - (outsideRadius + 5));
    ctx.lineTo(150 + 4, 150 - (outsideRadius - 5));
    ctx.lineTo(150 - 4, 150 - (outsideRadius - 5));
    ctx.fill();
  }
}

function spinWheel() {
  if (names.length === 0) {
    alert("Please add Clinical Instructors first!");
    return;
  }
  spinAngleStart = Math.random() * 10 + 10;
  spinTime = 0;
  spinTimeTotal = 5000; // 5 seconds suspense
  rotateWheel();
}

function rotateWheel() {
  spinTime += 30;
  if (spinTime >= spinTimeTotal) {
    stopRotateWheel();
    return;
  }
  let spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
  startAngle += (spinAngle * Math.PI / 180);
  drawWheel();
  spinTimeout = setTimeout(rotateWheel, 30);
}

function stopRotateWheel() {
  clearTimeout(spinTimeout);
  let degrees = startAngle * 180 / Math.PI + 90;
  let arcd = arc * 180 / Math.PI;
  let index = Math.floor((360 - (degrees % 360)) / arcd);
  ctx.save();
  ctx.font = 'bold 16px Arial';
  let winner = names[index];
  document.getElementById("clinicianName").value = winner;
  addResult(winner);
  ctx.restore();
}

function easeOut(t, b, c, d) {
  let ts = (t/=d)*t;
  let tc = ts*t;
  return b+c*(tc + -3*ts + 3*t);
}

document.getElementById("nameInput").addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    e.preventDefault();
    let name = this.value.trim();
    if (name && !names.includes(name)) {
      names.push(name);
      colors.push(getRandomColor());
      addTag(name);
      drawWheel();
    }
    this.value = "";
  }
});

function addTag(name) {
  let tag = document.createElement("span");
  tag.className = "tag";
  tag.textContent = name;
  tag.onclick = function() {
    let idx = names.indexOf(name);
    if (idx > -1) {
      names.splice(idx, 1);
      colors.splice(idx, 1);
      tag.remove();
      drawWheel();
    }
  };
  document.getElementById("nameTags").appendChild(tag);
}

function getRandomColor() {
  let letters = '0123456789ABCDEF';
  let color = '#';
  for (let i=0; i<6; i++) {
    color += letters[Math.floor(Math.random()*16)];
  }
  return color;
}

function addResult(winner) {
  let table = document.getElementById("resultsTable").querySelector("tbody");
  let row = table.insertRow();
  let c1 = row.insertCell(0);
  let c2 = row.insertCell(1);
  let c3 = row.insertCell(2);
  let c4 = row.insertCell(3);
  let c5 = row.insertCell(4);
  let c6 = row.insertCell(5);

  c1.textContent = winner;
  c2.textContent = document.getElementById("clinicianName").value;
  c3.textContent = document.getElementById("clinicalLevel").value;
  c4.textContent = document.getElementById("clinicalProcedure").value;
  c5.textContent = ""; // Completed column (black, editable later in Word)
  
  [c1, c2, c3, c4].forEach(cell => cell.contentEditable = "true");

  let btn = document.createElement("button");
  btn.textContent = "âŒ";
  btn.onclick = () => row.remove();
  c6.appendChild(btn);
}

function printTable() {
  let printWindow = window.open('', '', 'width=800,height=600');
  printWindow.document.write('<html><head><title>Results</title></head><body>');
  printWindow.document.write(document.getElementById("resultsTable").outerHTML);
  printWindow.document.write('</body></html>');
  printWindow.document.close();
  printWindow.print();
}

function saveCSV() {
  let table = document.getElementById("resultsTable");
  let rows = table.querySelectorAll("tr");
  let csv = [];
  rows.forEach(row => {
    let cols = row.querySelectorAll("th, td");
    let data = [];
    cols.forEach(cell => data.push(cell.innerText));
    csv.push(data.join(","));
  });
  let blob = new Blob([csv.join("\n")], { type: "text/csv" });
  let link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "results.csv";
  link.click();
}

function resetResults() {
  document.querySelector("#resultsTable tbody").innerHTML = "";
}

drawWheel();
</script>

</body>
    </html>
