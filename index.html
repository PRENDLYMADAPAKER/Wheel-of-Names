<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clinical Instructor Picker</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    color: #333;
    text-align: center;
    padding: 20px;
  }
  h1 {
    color: #1565c0;
  }
  .container {
    max-width: 1000px;
    margin: auto;
  }
  canvas {
    background: white;
    border-radius: 50%;
    margin: 20px auto;
    display: block;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
  }
  button {
    background: #1565c0;
    color: white;
    border: none;
    padding: 10px 18px;
    font-size: 16px;
    margin: 5px;
    border-radius: 6px;
    cursor: pointer;
    transition: transform 0.15s, background 0.3s;
  }
  button:hover {
    background: #0d47a1;
  }
  button:active {
    transform: scale(0.95);
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    background: white;
    box-shadow: 0 0 15px rgba(0,0,0,0.05);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
  }
  th {
    background: #1565c0;
    color: white;
  }
  tr:nth-child(even) {
    background: #f2f2f2;
  }
  .card {
    background: white;
    padding: 15px;
    margin-top: 20px;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.05);
  }
</style>
</head>
<body>

<div class="container">
  <h1>Clinical Instructor Picker</h1>
  <textarea id="nameList" rows="4" style="width:100%;" placeholder="Enter Clinical Instructor names, separated by commas"></textarea><br>
  <button onclick="loadNames()">Load Names into Wheel</button>

  <div class="card">
    <canvas id="wheelCanvas" width="400" height="400"></canvas><br>
    <button onclick="spinWheel()">Spin Wheel</button>
    <button onclick="removeWinner()">Remove Winner from Wheel</button>
  </div>

  <h3 id="winnerDisplay">Your Clinical Instructor: </h3>

  <div class="card">
    <h3>Results Table</h3>
    <button onclick="saveCSV()">Save CSV</button>
    <button onclick="window.print()">Print</button>
    <button onclick="resetTable()">Reset Table</button>
    <table id="resultsTable">
      <thead>
        <tr>
          <th>Clinician Name</th>
          <th>Clinical Level</th>
          <th>Time/Date Taken</th>
          <th>Clinical Procedure</th>
          <th>Clinical Instructor</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<script>
let names = [];
let startAngle = 0;
let arc = 0;
let spinTimeout = null;
let spinAngleStart = 0;
let spinTime = 0;
let spinTimeTotal = 0;
let ctx;

function loadNames() {
  const text = document.getElementById("nameList").value.trim();
  names = text ? text.split(",").map(n => n.trim()).filter(n => n) : [];
  arc = Math.PI / (names.length / 2);
  drawRouletteWheel();
}

function drawRouletteWheel() {
  const canvas = document.getElementById("wheelCanvas");
  if (canvas.getContext) {
    const outsideRadius = 180;
    const textRadius = 140;
    const insideRadius = 30;
    ctx = canvas.getContext("2d");
    ctx.clearRect(0,0,400,400);

    ctx.strokeStyle = "black";
    ctx.lineWidth = 2;
    ctx.font = 'bold 14px Arial';

    for(let i = 0; i < names.length; i++) {
      const angle = startAngle + i * arc;
      ctx.fillStyle = i % 2 === 0 ? "#42a5f5" : "#90caf9";
      ctx.beginPath();
      ctx.arc(200, 200, outsideRadius, angle, angle + arc, false);
      ctx.arc(200, 200, insideRadius, angle + arc, angle, true);
      ctx.stroke();
      ctx.fill();
      ctx.save();
      ctx.fillStyle = "white";
      ctx.translate(200 + Math.cos(angle + arc / 2) * textRadius,
                    200 + Math.sin(angle + arc / 2) * textRadius);
      ctx.rotate(angle + arc / 2);
      const text = names[i];
      ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
      ctx.restore();
    }

    // Arrow
    ctx.fillStyle = "red";
    ctx.beginPath();
    ctx.moveTo(200 - 4, 20);
    ctx.lineTo(200 + 4, 20);
    ctx.lineTo(200 + 4, 40);
    ctx.lineTo(200 + 9, 40);
    ctx.lineTo(200 + 0, 60);
    ctx.lineTo(200 - 9, 40);
    ctx.lineTo(200 - 4, 40);
    ctx.lineTo(200 - 4, 20);
    ctx.fill();
  }
}

function spinWheel() {
  spinAngleStart = Math.random() * 10 + 10;
  spinTime = 0;
  spinTimeTotal = Math.random() * 3000 + 4000;
  rotateWheel();
}

function rotateWheel() {
  spinTime += 30;
  if (spinTime >= spinTimeTotal) {
    stopRotateWheel();
    return;
  }
  const spinAngle = spinAngleStart - easeOut(spinTime, 0, spinAngleStart, spinTimeTotal);
  startAngle += (spinAngle * Math.PI / 180);
  drawRouletteWheel();
  spinTimeout = setTimeout(rotateWheel, 30);
}

function stopRotateWheel() {
  clearTimeout(spinTimeout);
  const degrees = startAngle * 180 / Math.PI + 90;
  const arcd = arc * 180 / Math.PI;
  const index = Math.floor((360 - (degrees % 360)) / arcd);
  const winner = names[index];
  document.getElementById("winnerDisplay").innerText = "Your Clinical Instructor: " + winner;

  const clinicianName = prompt("Enter Clinician Name:");
  const clinicalLevel = prompt("Enter Clinical Level (42/41/32/31):");
  const procedure = prompt("Enter Clinical Procedure:");
  const now = new Date().toLocaleString();

  const tableBody = document.querySelector("#resultsTable tbody");
  const row = tableBody.insertRow();
  row.insertCell(0).innerText = clinicianName || "-";
  row.insertCell(1).innerText = clinicalLevel || "-";
  row.insertCell(2).innerText = now;
  row.insertCell(3).innerText = procedure || "-";
  row.insertCell(4).innerText = winner;
}

function easeOut(t, b, c, d) {
  const ts = (t/=d)*t;
  const tc = ts*t;
  return b+c*(tc + -3*ts + 3*t);
}

function removeWinner() {
  const currentWinner = document.getElementById("winnerDisplay").innerText.replace("Your Clinical Instructor: ", "").trim();
  if (currentWinner && names.includes(currentWinner)) {
    names = names.filter(n => n !== currentWinner);
    arc = Math.PI / (names.length / 2);
    drawRouletteWheel();
    document.getElementById("winnerDisplay").innerText = "Your Clinical Instructor: ";
  }
}

function saveCSV() {
  let csv = [];
  const rows = document.querySelectorAll("#resultsTable tr");
  rows.forEach(row => {
    const cols = row.querySelectorAll("td, th");
    const rowData = [];
    cols.forEach(col => rowData.push(col.innerText));
    csv.push(rowData.join(","));
  });
  const blob = new Blob([csv.join("\n")], { type: "text/csv" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "results.csv";
  link.click();
}

function resetTable() {
  document.querySelector("#resultsTable tbody").innerHTML = "";
}

</script>
</body>
</html>
